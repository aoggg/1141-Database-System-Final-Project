{% extends "base.html" %}

{% block content %}
    <div class="view-switch-container" style="margin-bottom: 10px;">
        <a href="{{ url_for('index', view='post', category=current_category) }}" class="btn btn-switch active">ğŸ“‹ è²¼æ–‡æª¢è¦–</a>
        <a href="{{ url_for('index', view='item', category=current_category) }}" class="btn btn-switch">ğŸ“¦ ç‰©å“æª¢è¦–</a>
    </div>

    <div class="category-filter" style="margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
        <strong>ğŸ” ç¯©é¸é¡åˆ¥ï¼š</strong>
        
        <a href="{{ url_for('index', view=view_mode) }}" 
           style="margin-right: 10px; {{ 'font-weight: bold; text-decoration: underline;' if not current_category else '' }}">
           å…¨éƒ¨
        </a>

        {% for cat in categories %}
            <a href="{{ url_for('index', view=view_mode, category=cat['category_id']) }}" 
               style="margin-right: 10px; {{ 'font-weight: bold; text-decoration: underline; color: red;' if current_category|string == cat['category_id']|string else '' }}">
               {{ cat['name'] }}
            </a>
        {% endfor %}
    </div>

    <h1>ğŸ æ ¡åœ’è´ˆç‰©æ¸…å–®</h1>
    <p>ç›®å‰é¡¯ç¤º <strong>{{ total }}</strong> ç¯‡è²¼æ–‡</p>

    {% for post in posts %}
    
        <div style="border: 1px solid black; margin: 20px; padding: 10px;">
            
            <h3>[è²¼æ–‡ ID: {{ post['post_id'] }}] {{ post['description'] }}</h3>
            by <a href="{{ url_for('public_profile', target_user_id=post['owner_id']) }}">
                {{ post['owner_name'] }}
            </a>
            <p>
                <!-- åœ°é»: {{ post['location_name'] }} |  -->
                ç‹€æ…‹: {{ 'é€²è¡Œä¸­' if post['available'] else 'å·²çµæ¡ˆ' }}
            </p>
            <ul>
                {% for item in post['items'] %}
                <li>
                    <strong>{{ item['item_name'] }}</strong> 
                    (å‰©é¤˜æ•¸é‡: {{ item['quantity'] }})
                    
                    {% if post['available'] and item['quantity'] > 0 %}
                        <form action="{{ url_for('claim', item_id=item['item_id']) }}" method="POST" style="display: inline;">
                            <input type="number" name="want_quantity" value="1" min="1" max="{{ item['quantity'] }}">
                            <button type="submit">ç´¢å–</button>
                        </form>
                    {% else %}
                        <span>(ç„¡æ³•ç´¢å–)</span>
                    {% endif %}
                </li>
                {% else %}
                    <li>æ­¤è²¼æ–‡æ²’æœ‰ç‰©å“ (å‡ºå¤§äº‹å“‡)</li>
                {% endfor %}
            </ul>
        </div>

    {% else %}
        <p>ç›®å‰å®Œå…¨æ²’æœ‰è²¼æ–‡è³‡æ–™ã€‚</p>
    {% endfor %}

{% endblock %}