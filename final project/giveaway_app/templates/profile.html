{% extends "base.html" %}

{% block content %}

    <h1>個人檔案</h1>
    <p>
        <strong>姓名：</strong> {{ user['name'] }} <br>
        <strong>帳號：</strong> @{{ user['username'] }} <br>
        <strong>單位：</strong> {{ user['organization'] }} <br>
        <strong>聯絡電話：</strong>
        {% if phones %}
            {% for p in phones %}
                <span>{{ p['phone_number'] }}</span>
                {% if not loop.last %}, {% endif %}
            {% endfor %}
        {% else %}
            <span style="color: red;">(尚未綁定電話)</span>
        {% endif %}
        
    </p>

    <p>
        <strong>信譽分數：</strong> {{ "%.1f"|format(user['avg_score']) }} 分 
        <small>(共 {{ user['review_count'] }} 人評價)</small>
    </p>

    <p>
        <a href="/change_pwd">[修改密碼]</a> | 
        <a href="/edit_name">[修改名稱]</a> | 
        <a href="/add_phone">[新增電話]</a> | 
        <a href="/logout">[登出]</a>
    </p>

    <hr>
    <h2>過去得到的評價</h2>
    <ul>
        {% for comment in comments %}
            <li>
                <strong> {{comment['rating']}} </strong> | {{comment['comment_str']}}
            </li>
        {% endfor %}
    </ul>

    <h2>我索取的物品</h2>
    <ul>
        {% for claim in claims %}
            <li>
                <strong>{{ claim['item_name'] }}</strong> (數量: {{ claim['quantity'] }})
                <br>
                來源貼文: {{ claim['post_title'] }} | 時間: {{ claim['trade_time'] }}
                <br>

                {% if claim['my_rating'] %}
                    <span>已評價: {{ claim['my_rating'] }} 分</span>
                {% else %}
                    <a href="{{ url_for('add_comment', post_id=claim['post_id']) }}">
                        [去寫評價]
                    </a>
                {% endif %}
            </li>
            <br> {% else %}
            <li>目前沒有索取紀錄。</li>
        {% endfor %}
    </ul>

    <hr>

    <h2>我刊登的貼文</h2>
    <ul>
        {% for post in posts %}
            <li>
                [ID: {{ post['post_id'] }}] <strong>{{ post['description'] }}</strong>
                <br>
                發布時間: {{ post['post_time'] }} | 物品數: {{ post['item_count'] }}
                <br>
                狀態: 
                {% if post['available'] %}
                    <span>進行中</span>
                {% else %}
                    <span>已結案</span>
                {% endif %}

                <form action="{{ url_for('delete_post', post_id=post['post_id']) }}" method="POST" style="display: inline;">
                    <button type="submit" onclick="return confirm('確定要刪除嗎？底下物品都會不見喔！')">
                        [刪除貼文]
                    </button>
                </form>
            </li>
            <br>
        {% else %}
            <li>目前沒有刊登紀錄。</li>
        {% endfor %}
    </ul>

    <hr>
    <div style="margin-top: 50px; border: 1px solid red; padding: 10px;">
        <h3 style="color: red;">⚠️ 危險區域</h3>
        <p>刪除帳號後，您所有的貼文、索取紀錄、評價都將永久消失，無法復原。</p>
        
        <form action="{{ url_for('delete_account') }}" method="POST">
            <button type="submit" 
                    style="background-color: red; color: white; cursor: pointer;"
                    onclick="return confirm('警告：確定要永久刪除您的帳號嗎？此動作無法復原！');">
                ☠️ 永久刪除帳號
            </button>
        </form>
    </div>

{% endblock %}